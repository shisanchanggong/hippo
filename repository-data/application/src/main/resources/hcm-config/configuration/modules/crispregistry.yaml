---
definitions:
  config:
    ? /hippo:configuration/hippo:modules/crispregistry/hippo:moduleconfig/crisp:resourceresolvercontainer/googleReCaptchaResourceResolver
    : crisp:beandefinition: "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans\
        \ xmlns=\"http://www.springframework.org/schema/beans\"\r\n       xmlns:xsi=\"\
        http://www.w3.org/2001/XMLSchema-instance\"\r\n       xsi:schemaLocation=\"\
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\"\
        >\r\n\r\n  <bean parent=\"abstractCrispSimpleJacksonRestTemplateResourceResolver\"\
        \r\n        class=\"org.onehippo.cms7.crisp.core.resource.jackson.SimpleJacksonRestTemplateResourceResolver\"\
        >\r\n    <property name=\"cacheEnabled\" value=\"${cache.enabled}\" />\r\n\
        \    <property name=\"baseUri\" value=\"${base.uri}\" />\r\n    <property\
        \ name=\"restTemplate\">\r\n      <bean class=\"org.springframework.web.client.RestTemplate\"\
        >\r\n        <property name=\"requestFactory\" ref=\"org.springframework.http.client.ClientHttpRequestFactory\"\
        \ />\r\n      </bean>\r\n    </property>\r\n    </bean>\r\n\r\n</beans>"
      crisp:propnames:
      - cache.enabled
      - base.uri
      crisp:propvalues:
      - 'false'
      - https://www.google.com
      jcr:primaryType: crisp:resourceresolver
    ? /hippo:configuration/hippo:modules/crispregistry/hippo:moduleconfig/crisp:resourceresolvercontainer/statisticsRestResourceResolver
    : crisp:beandefinition: "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans\
        \ xmlns=\"http://www.springframework.org/schema/beans\"\r\n       xmlns:xsi=\"\
        http://www.w3.org/2001/XMLSchema-instance\"\r\n       xsi:schemaLocation=\"\
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\"\
        >\r\n\r\n  <bean parent=\"abstractCrispSimpleJacksonRestTemplateResourceResolver\"\
        \r\n        class=\"org.onehippo.cms7.crisp.core.resource.jackson.SimpleJacksonRestTemplateResourceResolver\"\
        >\r\n    <property name=\"cacheEnabled\" value=\"${cache.enabled}\" />\r\n\
        \    <property name=\"restTemplate\">\r\n      <bean class=\"org.springframework.web.client.RestTemplate\"\
        >\r\n        <property name=\"requestFactory\" ref=\"org.springframework.http.client.ClientHttpRequestFactory\"\
        \ />\r\n      </bean>\r\n    </property>\r\n    </bean>\r\n\r\n</beans>"
      crisp:propnames:
      - cache.enabled
      - base.uri
      crisp:propvalues:
      - 'true'
      - ''
      jcr:primaryType: crisp:resourceresolver
    ? /hippo:configuration/hippo:modules/crispregistry/hippo:moduleconfig/crisp:resourceresolvercontainer/apigeeManagementApi
    : crisp:beandefinition: "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
                             <beans xmlns=\"http://www.springframework.org/schema/beans\"
                                    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"
                                    xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">

                                 <bean id=\"apigeeManagementApi\"
                                       parent=\"abstractCrispSimpleJacksonRestTemplateResourceResolver\"
                                       class=\"org.onehippo.cms7.crisp.core.resource.jackson.SimpleJacksonRestTemplateResourceResolver\">
                                     <property name=\"cacheEnabled\" value=\"false\" />
                                     <property name=\"restTemplate\">
                                         <bean class=\"org.springframework.security.oauth2.client.OAuth2RestTemplate\">
                                             <constructor-arg>
                                                 <bean class=\"org.springframework.security.oauth2.client.token.grant.password.ResourceOwnerPasswordResourceDetails\">
                                                     <property name=\"clientAuthenticationScheme\" value=\"form\" />
                                                     <property name=\"grantType\" value=\"password\" />
                                                     <property name=\"accessTokenUri\" value=\"${devzone.apigee.oauth.token.url}\" />
                                                     <property name=\"username\" value=\"${DEVZONE_APIGEE_OAUTH_USERNAME}\" />
                                                     <property name=\"password\" value=\"${DEVZONE_APIGEE_OAUTH_PASSWORD}\" />
                                                 </bean>
                                             </constructor-arg>
                                             <constructor-arg>
                                                 <bean class=\"org.springframework.security.oauth2.client.DefaultOAuth2ClientContext\">
                                                     <constructor-arg>
                                                         <bean class=\"org.springframework.security.oauth2.client.token.DefaultAccessTokenRequest\">
                                                         </bean>
                                                     </constructor-arg>
                                                 </bean>
                                             </constructor-arg>

                                             <property name=\"requestFactory\">
                                                <bean class=\"org.springframework.http.client.BufferingClientHttpRequestFactory\">
                                                    <constructor-arg>
                                                        <bean class=\"org.springframework.http.client.SimpleClientHttpRequestFactory\">
                                                        </bean>
                                                    </constructor-arg>
                                                </bean>
                                             </property>

                                             <property name=\"accessTokenProvider\">
                                                 <bean class=\"org.springframework.security.oauth2.client.token.grant.password.ResourceOwnerPasswordAccessTokenProvider\">
                                                     <property name=\"tokenRequestEnhancer\">
                                                         <bean class=\"uk.nhs.digital.apispecs.apigee.auth.ApigeeTokenRequestOneTimePasswordEnhancer\">
                                                             <constructor-arg>
                                                                 <bean class=\"uk.nhs.digital.apispecs.apigee.auth.GoogleAuthOtpGenerator\">
                                                                 </bean>
                                                             </constructor-arg>
                                                             <constructor-arg value=\"${DEVZONE_APIGEE_OAUTH_OTPKEY}\" />
                                                             <constructor-arg value=\"${DEVZONE_APIGEE_OAUTH_BASICAUTHTOKEN}\" />
                                                         </bean>
                                                     </property>
                                                 </bean>
                                             </property>
                                             <property name=\"interceptors\">
                                                  <list>
                                                    <bean class=\"uk.nhs.digital.apispecs.apigee.auth.RequestResponseLoggingInterceptor\">
                                                    </bean>
                                                  </list>
                                             </property>
                                         </bean>
                                     </property>
                                 </bean>
                             </beans>"
      jcr:primaryType: crisp:resourceresolver
